unit uPrincipal;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.Imaging.pngimage, Vcl.ExtCtrls,uUtil,
  Vcl.Buttons, Vcl.StdCtrls,uExportacao, Data.DB, Vcl.Grids, Vcl.DBGrids,uConexaoBanco,uControleSQL,
  Datasnap.Provider, Datasnap.DBClient,uThread;

type
  TfrGematriaPrincipal = class(TForm)
    edTexto: TEdit;
    Image1: TImage;
    SpeedButton2: TSpeedButton;
    Panel1: TPanel;
    Panel2: TPanel;
    Panel3: TPanel;
    Label2: TLabel;
    Label3: TLabel;
    Label4: TLabel;
    Label1: TLabel;
    Label5: TLabel;
    Label6: TLabel;
    Label7: TLabel;
    Label8: TLabel;
    Panel5: TPanel;
    Panel6: TPanel;
    Panel7: TPanel;
    Panel8: TPanel;
    DBGrid1: TDBGrid;
    ClientDataSet1: TClientDataSet;
    DataSource1: TDataSource;
    DataSetProvider1: TDataSetProvider;
    ckREV: TCheckBox;
    ckFULLORD: TCheckBox;
    ckFULLREV: TCheckBox;
    ClientDataSet1BDWORD: TStringField;
    ClientDataSet1ORDVALUE: TIntegerField;
    ClientDataSet1REVALUE: TIntegerField;
    ClientDataSet1FULLORDVALUE: TIntegerField;
    ClientDataSet1FULLREVALUE: TIntegerField;
    SpeedButton1: TSpeedButton;
    Panel4: TPanel;
    SpeedButton3: TSpeedButton;
    Label10: TLabel;
    Label9: TLabel;
    DBGrid2: TDBGrid;
    DBGrid3: TDBGrid;
    procedure SpeedButton2Click(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure edTextoChange(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure FormKeyUp(Sender: TObject; var Key: Word; Shift: TShiftState);
    procedure ckOrdClick(Sender: TObject);
    procedure ckREVClick(Sender: TObject);
    procedure ckFULLORDClick(Sender: TObject);
    procedure ckFULLREVClick(Sender: TObject);
    procedure SpeedButton3Click(Sender: TObject);

  private
     thrCalcula:TThreadCalcula;
     Util:TUtil;
     TSQL:TExecSQL;
     FConnection:TBDConnection;
     FULLORD:boolean;
     FULLREV:boolean;
     ORD    :boolean;
     REV    :boolean;
     function getWhereDados(ckREV,ckFULLORD,ckFULLREV:TCheckBox):string;

  public
    FORDVALUE:String;
    FREVVALUE:String;
    FFULLORDVALUE:String;
    FFULLREVVALUE:String;

  end;

var
  frGematriaPrincipal: TfrGematriaPrincipal;

implementation

{$R *.dfm}

procedure TfrGematriaPrincipal.ckFULLORDClick(Sender: TObject);
begin
  FULLORD:=ckFULLORD.Checked
end;

procedure TfrGematriaPrincipal.ckFULLREVClick(Sender: TObject);
begin
  FULLREV:=ckFULLREV.Checked;
end;

procedure TfrGematriaPrincipal.ckOrdClick(Sender: TObject);
begin
//  ORD:=ckOrd.Checked;
end;

procedure TfrGematriaPrincipal.ckREVClick(Sender: TObject);
begin
  REV:=ckREV.Checked;
end;

procedure TfrGematriaPrincipal.edTextoChange(Sender: TObject);
var
thrsqlgrid:TThreadCarregaPalavras;
wSQL:String;
begin
//  wSQL:=EmptyStr;
//  if not(trim(edTexto.Text) = EmptyStr) then
//     begin
//          thrsqlgrid:=TThreadCarregaPalavras.create(true);
//          thrsqlgrid.ClientDataSet1:=ClientDataSet1;
//          thrsqlgrid.edit:=edTexto;
//          thrsqlgrid.Resume;
//        ClientDataSet1.Close;
//        wSQL:=' select * from wordstb wd where ordvalue = '+inttostr(Util.ValorOrd(trim(edTexto.Text)));
//        ClientDataSet1.commandtext:='select * from wordstb wd where ordvalue = '+inttostr(Util.ValorOrd(trim(edTexto.Text)));
//        ClientDataSet1.open;
//     end
//     else
//      begin
//        ClientDataSet1.Close;
//        ClientDataSet1.commandtext:='select * from wordstb ';
//        ClientDataSet1.open;
//        Label5.Caption:= '0';
//        Label6.Caption:= '0';
//        Label7.Caption:= '0';
//        Label8.Caption:= '0';
//      end;

end;

procedure TfrGematriaPrincipal.FormCreate(Sender: TObject);

begin

 Util:=TUtil.create;
 Util.pCriaPopulaStringList;
 FConnection  := TBDConnection.Create;
 TSQL:=TExecSQL.Create;

  DataSetProvider1.DataSet:=TSQL.CommandText;
  ClientDataSet1.Close;
  ClientDataSet1.commandtext:='select * from wordstb wd where upper(wd.bdword) like UPPER(''AB%'')';
  ClientDataSet1.open;
// ckOrd.Checked:= true;
  FULLORD      :=true;
  FULLREV      :=false;                -
  ORD          :=false;
  REV          :=false;

end;

procedure TfrGematriaPrincipal.FormKeyUp(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
  if Key = VK_ESCAPE then
     begin
//      if Sender(frExportacao) then
//          showmessage('fodase')
//      Application.Terminate;
     end;
end;

procedure TfrGematriaPrincipal.FormShow(Sender: TObject);
var
  thrCalcula:TThreadCalcula;
begin
end;

function TfrGematriaPrincipal.getWhereDados(ckREV,ckFULLORD,ckFULLREV:TCheckBox): string;
var
  wSQL:String;
begin

  wSQL:=' awhere ORDVALUE='+FORDVALUE;

  if ckREV.Checked then
     wSQL:= wSQL + ' and REVALUE ='+FREVVALUE;
  if ckFULLORD.Checked then
     wSQL:= wSQL + ' and FULLORDVALUE ='+FFULLORDVALUE;
  if ckFULLREV.Checked then
     wSQL:= wSQL + ' and FULLREVALUE ='+FFULLREVVALUE;

  result := wSQL;



end;

procedure TfrGematriaPrincipal.SpeedButton2Click(Sender: TObject);
begin
   TfrExportacao.Create(self).Show;
end;

procedure TfrGematriaPrincipal.SpeedButton3Click(Sender: TObject);
var
wSQL:string;
begin
        thrCalcula:=TThreadCalcula.create(true);
        thrCalcula.ORDlabel:=Label5;
        thrCalcula.REVlabel:=Label6;
        thrCalcula.FULLREVlabel:=label7;
        thrCalcula.FULLORDlabel:=Label8;
        thrCalcula.inputext:=trim(edTexto.Text);
        thrCalcula.FORDVALUE:=FORDVALUE;
        thrCalcula.FREVVALUE:=FREVVALUE;
        thrCalcula.FFULLORDVALUE:=FFULLORDVALUE;
        thrCalcula.FFULLREVVALUE:=FFULLREVVALUE;
        thrCalcula.Resume;

        ClientDataSet1.Close;
        wSQL:='select * from wordstb'+getWhereDados(ckREV,ckFULLORD,ckFULLREV);
        ClientDataSet1.commandtext:=  wSQL;
        ClientDataSet1.open;

end;

end.
